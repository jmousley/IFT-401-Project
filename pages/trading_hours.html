{% extends "base.html" %}
{% block title %}Edit Market Hours{% endblock %}
{% block content %}

<div class="d-flex flex-column justify-content-center align-items-center" style="min-height: calc(100vh - 120px); padding-bottom: 40px;">
            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    {% for category, message in messages %}
                        <div class="alert alert-{{ category }}">{{ message }}</div>
                {% endfor %}
            {% endif %}
        {% endwith %}
    <div class="container tertiary rounded-5 p-5" style="max-width: 700px;">
        <h1 class="text-center">Edit Market Hours</h1>
        <div class="d-flex justify-content-center mb-3 align-items-center">
            <form method="post" action="{{ url_for('market_toggle') }}" class="d-flex align-items-center">
                <div class="form-check form-switch me-3" style="transform: scale(1.1);">
                    <input class="form-check-input" type="checkbox" id="market_enabled" name="enabled" {% if market_control is none or market_control.market_enabled %}checked{% endif %}>
                    <label class="form-check-label" for="market_enabled">Force Market Open/Close</label>
                </div>
                <button type="submit" class="btn btn-sm btn-primary me-3">Apply</button>
            </form>
            {% if market_control is none %}
                <span class="badge bg-secondary">Status: Enabled (default)</span>
            {% elif market_control.market_enabled %}
                <span class="badge bg-success">Status: Enabled</span>
            {% else %}
                <span class="badge bg-danger">Status: Disabled</span>
            {% endif %}
        </div>
        <form action="/edit_market_hours" method="POST">

            <div class="row justify-content-center">
                <div class="col-md-6 mt-4">
                    <div class="mb-3"> 
                        <label class="form-label">Day of the Week:</label>
                        <select class="form-select" name="day_of_week" id="day_of_week" required>
                            <option value="Sunday">Sunday</option>
                            <option value="Monday">Monday</option>
                            <option value="Tuesday">Tuesday</option>
                            <option value="Wednesday">Wednesday</option>
                            <option value="Thursday">Thursday</option>
                            <option value="Friday">Friday</option>
                            <option value="Saturday">Saturday</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="row justify-content-center">
                <div class="col-md-3">
                    <div class="mb-3">
                        <label class="form-label">Start Time:</label>
                        <input type="time" name="start_time" class="form-control" id="start_time" required>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="mb-3">
                        <label class="form-label">End Time:</label>
                        <input type="time" name="end_time" class="form-control" id="end_time" required>
                    </div>
                </div>
            </div>

             <div class="row justify-content-center mt-3">
                <div class="col-auto">
                    <button type="submit" class="btn btn-primary">Submit</button>
                </div>
             </div>
        </form>
    </div>
</div>



<script>
document.getElementById('day_of_week').addEventListener('change', function() {
    const day = this.value;
    if (!day) return;

    fetch(`/get_market_hours?day=${day}`)
        .then(response => response.json())
        .then(data => {
            if (data.error) {
                alert(data.error);
                return;
            }

            document.getElementById('start_time').value = data.start_time || '';
            document.getElementById('end_time').value = data.end_time || '';
        })
});

window.addEventListener('DOMContentLoaded', function() {
    const select = document.getElementById('day_of_week');
    const defaultDay = select.value;
    if (defaultDay) {
        fetch(`/get_market_hours?day=${defaultDay}`)
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    alert(data.error);
                    return;
                }

                document.getElementById('start_time').value = data.start_time || '';
                document.getElementById('end_time').value = data.end_time || '';
            });
    }
});
</script>

{% endblock %}