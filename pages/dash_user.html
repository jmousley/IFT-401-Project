{% extends "base.html" %}
{% block title %}User Dashboard{% endblock %}
{% block content %}


    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="alert alert-{{ category }}">{{ message }}</div>
            {% endfor %}
        {% endif %}
    {% endwith %}
<div class="container-fluid p-5 pt-4">
    
  <h1 class="pb-2">User Dashboard</h1>
  <div class="d-flex justify-content-between align-items-center">
    <h3>Welcome, {{ current_user.fname }}</h3>
    <h3 style="margin-left: 55%;">{{"Market Status - " ~ status}}</h3>
    <h3>{{ current_time }}</h3>
  </div>

  <div class="row">

    <!-- Left side -->
    <div class="col-md-5">
      <div class="row">
        <div class="col-md-4 pb-3">
          <div class="mb-3 mt-3 bg-secondary d-flex flex-column align-items-start p-3 rounded">
            <h4 class="mb-1">Balance:</h4>
            <h3 class="mb-3">${{ "%.2f"|format(current_user.balance) }}</h3>
            <form action="{{ url_for('add_funds', id=current_user.id) }}" method="post">
              <button type="submit" class="btn btn-primary">Add funds</button>
            </form>
          </div>
        </div>
        <div class="col-md-6 pb-3">
          <div class="mb-3 mt-3 bg-secondary d-flex flex-column align-items-start p-3 rounded">
            <h4 class="mb-1">Portfolio Value:</h4>
            <h3 class="mb-3">${{  "%.2f"|format(portfolio_value)  }}</h3>
            <button type="submit" class="btn btn-primary">Add funds</button>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col-md-4 pb-3 d-flex">
          <div class="mb-3 mt-3 bg-secondary d-flex flex-column align-items-start p-3 rounded flex-fill">
            <h4 class="mb-1">Example buttons</h4>
          </div>
        </div>
        <div class="col-md-6 pb-3 d-flex">
          <div class="mb-3 mt-3 bg-secondary d-flex flex-column align-items-start p-3 rounded flex-fill">
            <h4 class="mb-1">Example buttons</h4>
          </div>
        </div>
      </div>
    </div>

    <!-- Right side -->
    <div class="col-md-7">
      <div class="mb-3 mt-3 bg-secondary p-3 rounded text-center" style="height: 500px;">
          <div class="table-responsive">
            <table class="table table-dark table-striped">
              <thead>
                <tr>
                  <th>Symbol</th>
                  <th>Shares Owned</th>
                  <th>Market Value</th>
                  <th>Total Value</th>
                  <th>Quick Actions</th>
                </tr>
              </thead>
              <tbody>
               {% for x in user_portfolio %}
                <tr>
                  <td>{{ x.stock.ticker }}</td>
                  <td>{{ x.quantity }}</td>
                  <td>${{  "%.2f"|format(x.stock.price)  }}</td>
                  <td>${{  "%.2f"|format(x.stock.price * x.quantity) }}</td>
                  <td>
                    <a href="{{ url_for('home') }}" class="btn btn-sm btn-primary">Buy</a>
                    <a href="{{ url_for('home') }}" class="btn btn-sm btn-primary">Sell</a>
                  </td>
                </tr>
                {% else %}
                <tr><td colspan="5" class="text-center">Your portfolio is empty! Browse through our *stock listings* to find your next investment.</td></tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
      </div>
    </div>
  </div>
</div>

{% endblock %}