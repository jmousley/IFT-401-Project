{% extends "base.html" %}
{% block title %}Admin Dashboard{% endblock %}
{% block content %}


    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="alert alert-{{ category }}">{{ message }}</div>
            {% endfor %}
        {% endif %}
    {% endwith %}
<div class="container-fluid pt-4" style="min-height: calc(80vh - 120px); padding-left: 5%; padding-right: 5%;">
  
  <h1 class="pb-2">Admin Dashboard</h1>
  <div class="d-flex justify-content-between align-items-center">
    <h3>Welcome, {{ current_user.fname }}</h3>
    <h3 style="margin-left: 55%;">{{"Market Status - " ~ status}}</h3>
    <h3>{{ current_time }}</h3>
  </div>

  <div class="row" style="min-height: calc(80vh - 120px); max-height: calc(80vh - 120px); height: calc(80vh - 120px);">

    <!-- Left side -->
    <div class="col-md-5 d-flex flex-column" style="height: 100%;">
      <div class="row">
        <div class="col-md-4 pb-3">
          <div class="mb-3 mt-3 secondary d-flex flex-column align-items-start p-3 rounded">
            <h4 class="mb-1">Balance:</h4>
            <h3 class="mb-3">${{ "%.2f"|format(current_user.balance) }}</h3>
            <a href="{{ url_for('add_funds') }}" class="btn btn-primary">Add funds</a>
          </div>
        </div>
        <div class="col-md-6 pb-3">
          <div class="mb-3 mt-3 secondary d-flex flex-column align-items-start p-3 rounded">
            <h4 class="mb-1">Portfolio Value:</h4>
            <h3 class="mb-3">${{ '%.2f'|format(portfolio_value) }}</h3>
          </div>
        </div>
      </div>

      <div class="row d-flex">

        <div class="col-md-3 pb-3 d-flex">
            <a href="{{ url_for('trading_hours') }}" class="text-decoration-none text-reset flex-fill button text-center pb-3" style="height: 100%;">
              <div class="mb-3 mt-3 secondary d-flex flex-column p-3 rounded justify-content-center" style="height: 100%;">
                <h4 class="mb-1">Market Schedule</h4>
              </div>
            </a>
        </div>

        <div class="col-md-3 pb-3 d-flex">
            <a href="{{ url_for('holiday_admin') }}" class="text-decoration-none text-reset flex-fill button text-center pb-3" style="height: 100%;">
              <div class="mb-3 mt-3 secondary d-flex flex-column p-3 rounded justify-content-center" style="height: 100%;">
                <h4 class="mb-1" >Holidays</h4>
              </div>
            </a>
        </div>

        <div class="col-md-4 pb-3 d-flex">
            <a href="{{ url_for('stock_admin') }}" class="text-decoration-none text-reset flex-fill button text-center pb-3" style="height: 100%;">
              <div class="mb-3 mt-3 secondary d-flex flex-column p-3 rounded justify-content-center" style="height: 100%;">
                <h4 class="mb-1">Stock Dashboard</h4>
              </div>
            </a>
        </div>

        <div class="col-md-4 pb-3 d-flex">
            <a href="{{ url_for('user_overview') }}" class="text-decoration-none text-reset flex-fill button text-center pb-3" style="height: 100%;">
              <div class="mb-3 mt-3 secondary d-flex flex-column p-3 rounded justify-content-center" style="height: 100%;">
                <h4 class="mb-1">User Overview</h4>
              </div>
            </a>
        </div>

      </div>
    </div>

    <!-- Right side -->
    <div class="col-md-7">
      <h3>Transaction history</h3>
      <div class="mb-3 mt-3 secondary p-3 rounded d-flex flex-column" style="height: 500px; padding: 0.75rem;">
          <div class="flex-grow-1 overflow-auto" style="min-height:0; /* allow flex child to scroll */">
            <table class="table table-dark table-striped table-sm mb-0">
              <thead>
                <tr>
                  <th>#</th>
                  <th>Date</th>
                  <th>User</th>
                  <th>Stock</th>
                  <th>Qty</th>
                  <th>Type</th>
                  <th>Total</th>
                </tr>
              </thead>
              <tbody>
                {% if transaction_summary %}
                  {% for t in transaction_summary %}
                  <tr>
                    <td>{{ loop.index }}</td>
                    <td>{{ t.date.strftime('%Y-%m-%d %H:%M') }}</td>
                    <td>{{ t.user.fname }} {{ t.user.lname }}</td>
                    <td>{{ t.stock.name }}</td>
                    <td>{{ t.quantity }}</td>
                    <td>{{ t.transaction_type }}</td>
                    <td>${{ '%.2f'|format(t.total_price) }}</td>
                  </tr>
                  {% endfor %}
                {% else %}
                  <tr><td colspan="7" class="text-center">No recent transactions.</td></tr>
                {% endif %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
      </div>
    </div>
  </div>

{% endblock %}