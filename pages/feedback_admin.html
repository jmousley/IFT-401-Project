{% extends "base.html" %}
{% block title %}User Feedback{% endblock %}
{% block content %}

    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="alert alert-{{ category }}">{{ message }}</div>
            {% endfor %}
        {% endif %}
    {% endwith %}

<div class="container pt-4" style="min-height: calc(80vh - 120px); padding-left: 5%; padding-right: 5%;">
  <h1 class="pb-2">User Feedback</h1>
  <div class="mb-3 mt-3 secondary p-3 rounded d-flex flex-column" style="padding: 0.75rem;">
      <div class="flex-grow-1 overflow-auto" style="min-height:0;">
        <table class="table table-dark table-striped table-sm mb-0">
          <thead>
            <tr>
              <th>#</th>
              <th>Date</th>
              <th>Email</th>
              <th>Name</th>
              <th>Subject</th>
              <th>Message</th>
              <th>Delete Ticket</th>
            </tr>
          </thead>
          <tbody>
            {% if messages %}
              {% for m in messages %}
              <tr>
                <td>{{ loop.index }}</td>
                <td>{{ m.date.strftime('%Y-%m-%d %H:%M') if m.date else "" }}</td>
                <td>{{ m.email }}</td>
                <td>{{ m.name }}</td>
                <td>{{ m.subject }}</td>
                <td style="max-width: 420px; white-space: pre-wrap;">{{ m.message }}</td>
                <td>
                  <form method="post" action="{{ url_for('delete_feedback', id=m.id) }}" onsubmit="return confirm('Delete this message?');" style="display:inline-block; margin:0;">
                    <button type="submit" class="btn btn-sm btn-danger">Delete</button>
                  </form>
                </td>
              </tr>
              {% endfor %}
            {% else %}
              <tr><td colspan="6" class="text-center">No feedback messages.</td></tr>
            {% endif %}
          </tbody>
        </table>
      </div>
    </div>
</div>

{% endblock %}
